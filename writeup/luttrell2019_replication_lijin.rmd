---
title: "Replication of Study 1 in Luttrell et al. (2019, Psychological Science)"
author: "Lijin Zhang (lijinzhang@stanford.edu)"
date: "`r format(Sys.time(), '%B %d, %Y')`"
output:
  html_document:
    toc: yes
    toc_depth: 3
    toc_float:
      collapsed: false
---

<!-- Replication reports should all use this template to standardize reporting across projects.  These reports will be public supplementary materials that accompany the summary report(s) of the aggregate results. -->

[link to the original paper](https://github.com/psych251/luttrell2019/blob/main/original_paper/Challenging%20Moral%20Attitudes%20With%20Moral%20Messages.pdf)

[link to the repository](https://github.com/psych251/luttrell2019)

## Introduction

<a href="#reference">Luttrell et al. ( 2019)</a> investigated whether the influence of moral counterattitudinal messages on attitude change depends on the extent that the initial attitudes were moralized.  They further explored the mediation effect of the perceptions/thoughts toward the message and the moderation effect of political orientation. To test the hypotheses, they conducted two studies on the attitudes toward recycling.


### Justification
I choose this paper to replicate because I have been working on factor analysis and structural equation modeling, thus I am very interested in self-reported data. This paper matches my research experiences and interests as it focused on variables (e.g., attitude) that were measured by scales. Besides, this paper used questionnaires to measure the variables of interest and the reliabilities of the questionnaires were reported in the paper. However, the construct validity was not reported in the paper. In addition to replicating the research, I want to further test the validity of the measurement tools used in this paper.




### Challenge 
The potential challenge in this study is the funding to collect sufficient samples. In the original paper, the authors took one dollar to recruit each participant, and they recruited around 200 people.

## Methods

### Power Analysis

*Original effect size, power analysis for samples to achieve 80%, 90%, 95% power to detect that effect size.  Considerations of feasibility for selecting planned sample size.*

### Planned Sample

The authors preregistered a target sample size of 200, which provided 80% power to detect an interaction effect as small as .04. They finally collected 415 samples for study 1. However, to save the money, I plan to collect 50 samples and each participant will get $1 for completing the 5-minute survey.

### Materials
This experiment will be conducted through [qualtrics](https://www.qualtrics.com/) and participants will be required to fill out a survey (I have designed [the survey](https://stanforduniversity.qualtrics.com/jfe/form/SV_5nj0m3Z5TAatCSi)). The questionnaire on attitude toward recycling, political orientation, perceptions about the message, as well as the stimuli (practical or moral arguments against recycling) used in the replication study will be the same as <a href="#reference">Luttrell et al. ( 2019)</a> (see the quote below). 

> Premessage attitudes. Participants rated their attitudes toward recycling using three 9-point semantic-differential scales, ranging from −4 (bad, dislike, and negative) to 4 (good, like, and positive). 

> Perceived attitude bases. Participants reported the degree to which their attitudes toward recycling were based on their core moral beliefs or on practical concerns using 5-point scales (ranging from not at all to extremely). These items were modeled after items previously used to assess moral conviction (see Skitka, 2010). These items were presented within a small set of randomly ordered questions about people’s bases for their recycling attitudes so participants would not suspect that the study was specifically about the moral basis for those attitudes. 

> Political orientation. Participants reported their political orientation on two items measuring ideology for social and economic issues. The items were measured on 5-point scales ranging from very liberal to very conservative. 

> Counterattitudinal message. We created two versions of an antirecycling essay that appealed either to moral or to practical concerns. The moral appeal, entitled “Recycling: Harmful and Immoral,” framed its antirecy- cling position in moral terms (e.g., “Supporting recycling programs would be a grave moral transgression”) and cited particular moral reasons against recycling programs (e.g., “precious pets and animals [are] mercilessly killed by fumes produced in the recycling process”). By contrast, the practical appeal, entitled “Recycling: Costly and Unfeasible,” framed its antirecycling position in prag- matic terms (e.g., recycling is an “inefficient and unfea- sible endeavor for most municipalities to adopt”) and cited particular economic and pragmatic concerns (e.g., “An increase in trucks greatly increases traffic, both on the highways and on city roads”). We chose a practical appeal as the comparison because it reflects a common type of nonmoral persuasive argument (e.g., Mucciaroni, 2011) that could be similarly substantive. Messages were similar in length (426–428 words) and in number of argu- ments, and they were designed to be equally cogent to the sample overall.

> Thought listing. Participants next listed the thoughts they had while reading the antirecycling message. Participants were given six thought-listing boxes and told to enter one thought per box; however, they were not required to fill all six. These thoughts were subsequently rated by two independent coders for overall valence (i.e., whether each thought was promessage, antimessage, neutral to the message, or unrelated to the message), following common practice. 

Note that since I will code it by myself, there will not be two independent coders.

> Postmessage attitudes. After reading the message, participants once again reported their attitudes toward recycling, using the same items used to measure premessage attitudes. 

> Message ratings. To ensure that participants perceived the messages as intended, we asked how much the mes- sage seemed to make arguments related to moral and practical concerns, each on 7-point scales ranging from not at all to very much.



### Procedure	

At the beginning of the survey, participants will be asked to read an introduction to recycling and report their attitude about recycling. Next, participants will be randomly assigned into two groups, and in one group, they will need to read a message arguing against recycling using a moral appeal. In another group, participants will be assigned a message arguing against recycling using a practical appeal. After reading the message, participants in each group need to report their attitudes toward recycling again. Also, they will be asked about their perceptions of the message, political orientation, age, gender, and the primary language they are using.


### Analysis Plan

#### Exclusion criteria
> First, we exclude any cases for which the message would be pro-attitudinal (i.e., attitudes toward recycling below the midpoint.)  Next, we excluded any cases that were duplicates of a previous participant’s IP Address. 

#### Reliability of measures
Calculate Cronbach’s alpha for the measures

#### Validity of measures
Conduct confirmatory factor analysis for the measures

#### Manipulation check 
> Data were submitted to t-test analyses to determine whether the messages were perceived as intended. 

#### Persuasion effects
> The data were submitted to a multiple regression analysis predicting postmessage attitudes in which pre- message attitudes, moral attitude basis, and message type were entered in the first step of the model and the Moral Attitude Basis × Message Type interaction term was entered in the second step. Message type was effects coded so that −1 corresponded with the moral- argument condition and +1 corresponded with the practical-argument condition. Results for these predic- tors are interpreted in the first steps of the model in which they appear. 

#### Mediation effect of valenced thoughts
> We computed the indirect effect and CIs with non- parametric bootstrapping (10,000 iterations) using the mediation package in R (Tingley, Yamamoto, Hirose, Keele, & Imai, 2014). We tested the indirect effect on postmessage attitudes, controlling for premessage atti- tudes, setting the Moral Attitude Basis × Message Type interaction term as the predictor; valenced thoughts as the mediator; premessage attitudes, moral attitude basis, and message type as covariates; and postmessage atti- tudes as the outcome variable. 

#### Effects of other attitude bases
> The fol- lowing analyses tested the interaction of each alternative basis with message type on postmessage attitudes, con- trolling for premessage attitudes.

#### Moderation effect of political orientation
> To assess whether political orientation moderated the Moral Attitude Basis × Message Type interaction, we subjected the data to a hierarchical multiple regression model that tested a three-way interaction on postmessage attitudes.



### Differences from Original Study

- Sample size will be smaller than the original study.

- The thought list will be coded by myself instead of two independent coders in the original study, so I cannot test consistency between coders.

- The original paper didn't conduct confirmatory factor analysis for construct validation, and I will try to conduct in the replication study.

### Methods Addendum (Post Data Collection)

You can comment this section out prior to final report with data collection.

#### Actual Sample
  Sample size, demographics, data exclusions based on rules spelled out in analysis plan

#### Differences from pre-data collection methods plan
  Any differences from what was described as the original plan, or “none”.


## Results of the Pilot Study
Currently this part is for coding up the planned analyses . **Note that the sample size of the pilot study (*N*=3) is not enough for the following analysis, so there are some warnings and errors**
	

### Data preparation

Data preparation following the analysis plan.


```{r include = F}
####Load Relevant Libraries and Functions
library(dplyr)
library(readr)
library(psych)
library(broom) 
library(lavaan)
library(ggplot2) 
#library(pwr) 
#library(mediation) 
library(ggeffects) 
#library(scales) 
#library(extrafont)
library(printr) 
library(kableExtra)
library(papaja) 
```

```{r}
####Import data
pilot_data <- read_csv("../data/pilot_data.csv", show_col_types = FALSE)
nrow(pilot_data)

#### Data exclusion / filtering
pilot_data0 <- pilot_data |> 
  mutate(att1 = (att1_1 + att1_2 + att1_3) / 3) |>
  mutate(att2 = (att2_1 + att2_2 + att2_3) / 3) |>
  mutate(att.pre = 0 - att1, att.post = 0 - att2) |>
  mutate(ideology = (poli_soc + poli_econ) / 2) 
table(pilot_data0$cond.F)

pilot_data1 <- pilot_data0 |> 
  filter(att1 >= 0) 


#### add columns
pilot_data1$base_mor_low <- scale(pilot_data1$base_mor, scale = F) + sd(pilot_data1$base_mor)
pilot_data1$base_mor_high <- scale(pilot_data1$base_mor, scale = F) - sd(pilot_data1$base_mor)
pilot_data1$base_mor_max <- pilot_data1$base_mor - 5
pilot_data1$cond_mor <- (pilot_data1$cond + 1) / 2
pilot_data1$cond_prac <- (abs(pilot_data1$cond - 1))/2
pilot_data1$ideology_low <- scale(pilot_data1$ideology, scale = F) + sd(pilot_data1$ideology, na.rm = T)
pilot_data1$ideology_high <- scale(pilot_data1$ideology, scale = F) - sd(pilot_data1$ideology, na.rm = T)
```

### Demographics
```{r}
nrow(pilot_data1) # sample size
table(pilot_data1$gender) # gender information
describe(pilot_data1$age) |> 
  select(mean, sd, median, min, max) |> round(2) # age
```

### Reliability and Validity

```{r}
#### reliability 
##### pre-message attitude
pilot_data1 |> select(att1_1, att1_2, att1_3) |> 
  psych::alpha() |> with(total) |> round(2)
#### post-message attitude
pilot_data1 |> select(att2_1, att2_2, att2_3) |> 
  psych::alpha() |> with(total) |> round(2)
#### Political Orientation
pilot_data1 |> select(poli_soc, poli_econ) |> 
  psych::alpha() |> with(total) |> round(2)


#### validity
model <- '
att_f1 =~ att1_1 + att1_2 + att1_3
att_f2 =~ att2_1 + att2_2 + att2_3
poli =~ poli_soc + poli_econ
'
var = c("att1_1", "att1_2", "att1_3", "att2_1", "att2_2", "att2_3", "poli_soc", "poli_econ")
# cfa_fit <- cfa(model, pilot_data1, var)
# note that currently the sample size is not enough for the cfa
  

```


```{r include = F}

# Set up plot theme
## (Thanks to John Sakaluk for this particular setup: 
## https://sakaluk.wordpress.com/2015/08/27/6-make-it-pretty-plotting-2-way-interactions-with-ggplot2/#APA)
apatheme <- theme_bw() +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        axis.line = element_line())

# Regression Display Function
## This function is useful for rounding estimates and displaying CIs alongside other output.
display.lm <- function(model) {
  df <- summary(model) |> with(df)
  display.obj <- tidy(model) |> bind_cols(confint_tidy(model)) |> 
    as.data.frame() |> mutate(p.value.char = ifelse(p.value < .001, "< .001", p.value),
                               p.value.3 = round(p.value, 3),
                               ` ` = ifelse(p.value < .001, "***", 
                                            ifelse(p.value < .01, "**", 
                                                   ifelse(p.value < .05, "*", 
                                                          ifelse(p.value < .10, ".", " "))))) |>
    mutate(p.value = as.character(ifelse(p.value < .001, "< .001", p.value.3)),
           df = df[2]) |>
    select(term, B = estimate, SE = std.error, t = statistic, df, p.value, conf.low, conf.high, ` `) |>
    mutate_if(is.numeric, round, 2)
  return(display.obj)
}

## Additional steps for formatting kable
kable.lm <- function(display.obj) {
  kable(display.obj, align = c("l", rep('c', ncol(display.obj) - 1))) |>
    kable_styling(bootstrap_options = c("hover", "condensed", "responsive"), 
                  full_width = F, position = "center")
}

# T-Test Display Function
## This function is useful for giving summary statistics and Cohen's d along with t-test output
display.t <- function(y, x, type = "ind", var.equal = T) {
  tmp <- data.frame(x = x, y = y)

  if(type=="ind") {
    desc <- describeBy(tmp$y, group = tmp$x, mat = T)
    Ms <- desc$mean
    SDs <- desc$sd
    t.out <- t.test(tmp$y ~ tmp$x, var.equal = var.equal)
    d.out <- effsize::cohen.d(tmp$y, tmp$x)
  }
  if(type=="dep") {
    desc <- describe(tmp)
    Ms <- desc$mean
    SDs <- desc$sd
    t.out <- t.test(tmp$y, tmp$x, var.equal = var.equal, paired = T)
    d.out <- effsize::cohen.d(tmp$y, tmp$x, paired = T)
  }
  out <- tidy(t.out) |>
    mutate(Mean1 = Ms[1], SD1 = SDs[1], Mean2 = Ms[2], SD2 = SDs[2],
           p.value.char = as.character(ifelse(p.value < .001, "< .001", round(p.value, 3)))) |>
    mutate_if(is.numeric, round, 3) |>
    select(Mean1, SD1, Mean2, SD2, t = statistic, df = parameter,
           p = p.value.char) |>
    mutate(d = d.out$estimate) |>
    mutate_if(is.numeric, round, 2)
  return(out)
}
```

### Manipulation Check
#### Perceived Morality and Practicality Between Message Conditions
```{r}
display.t(y = pilot_data1$essMoral, x = pilot_data1$cond.F) |>
  kable(align=rep('c', 8)) |>
  kable_styling(full_width = F, position = "center") |>
  column_spec(1:8, width = "5em")


#display.t(y = pilot_data1$essPrac, x = pilot_data1$cond.F) |>
#  kable(align=rep('c', 8)) |>
#  kable_styling(full_width = F, position = "center") |>
#  column_spec(1:8, width = "5em")
```

### Persuasion Effects

```{r}
##### main effect
pers.ME <- lm(att.post ~ att.pre + cond + base_mor, pilot_data1)
# display.lm(pers.ME) |> kable.lm()

##### interaction
pers.int <- lm(att.post ~ att.pre + cond * base_mor, pilot_data1)
# display.lm(pers.int) |> kable.lm()

##### effect size
R2.ME <- summary(pers.ME) |> with(r.squared)
R2.Full <- summary(pers.int) |> with(r.squared)
f2 <- round((R2.Full - R2.ME)/(1 - R2.Full), 2)
# print(paste("$f^{2}$ = ", f2))

```


### Mediation Effect of Valenced Thoughts
cannot conduct this now - requires coding of the thoughts

### Moderation by Political Orientation
```{r}
ideo.ME <- lm(att.post ~ att.pre + cond + base_mor + ideology, pilot_data1)
summary(ideo.ME)

ideo.2way <- lm(att.post ~ att.pre + cond * base_mor + cond * ideology + base_mor * ideology, pilot_data1)


ideo.3way <- lm(att.post ~ att.pre + cond * base_mor * ideology, pilot_data1)
```

### Effects of Other Attitude Bases
```{r}
# practical bias
lm(att.post ~ att.pre + cond * base_prac, pilot_data1)

# Emotion Basis
pilot_data1$base_emo_low <- scale(pilot_data1$base_emo) + sd(pilot_data1$base_emo)
pilot_data1$base_emo_high <- scale(pilot_data1$base_emo) - sd(pilot_data1$base_emo)

lm(att.post ~ att.pre + cond * base_emo, pilot_data1)

# Knowlege Basis
lm(att.post ~ att.pre + cond * base_know + cond * base_mor, pilot_data1)

# Consenus Basis
lm(att.post ~ att.pre + cond * base_cons + cond * base_mor, pilot_data1)
```


The analyses as specified in the analysis plan.  

*Side-by-side graph with original graph is ideal here*


## Discussion

### Summary of Replication Attempt

Open the discussion section with a paragraph summarizing the primary result from the confirmatory analysis and the assessment of whether it replicated, partially replicated, or failed to replicate the original result.  

### Commentary

Add open-ended commentary (if any) reflecting (a) insights from follow-up exploratory analysis, (b) assessment of the meaning of the replication (or not) - e.g., for a failure to replicate, are the differences between original and present study ones that definitely, plausibly, or are unlikely to have been moderators of the result, and (c) discussion of any objections or challenges raised by the current and original authors about the replication attempt.  None of these need to be long.


## Reference
<a name="#reference"></a>
Luttrell, A., Philipp-Muller, A., & Petty, R. E. (2019). Challenging moral attitudes with moral messages. *Psychological Science, 30*(8), 1136-1150.
